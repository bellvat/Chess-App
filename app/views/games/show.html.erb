<script>
    $( function() {
      //Assigns selectable pieces based on who's go it is. Will have to be more complicated than this
      <% if @game.turn_user_id == @game.white_player_user_id %>
        $(".white-piece").addClass("selectable-piece");
      <% else %>
        $(".white-piece").addClass("selectable-piece");
      <% end %>

      //Ultimately, we'll have to assign droppable square based on piece rules and position of other pieces
      $("td").addClass("droppable-square");


      $( ".selectable-piece" ).draggable({
        cancel: "a.ui-icon", // clicking an icon won't initiate dragging
        revert: "invalid", // when not dropped, the item will revert back to its initial position
        containment: "document",
        snap: ".document td",
        snapTolerance: 20,
        helper: "clone",
        cursor: "move"
      });
      $( ".droppable-square").droppable({
        accept: ".selectable-piece",
        tolerance: "pointer",
        classes: {
          "ui-droppable-active": "ui-state-active",
          "ui-droppable-hover": "ui-state-hover"
        },
        drop: function( event, ui ) {
          console.log(ui.draggable.attr('id') + " moved to " + this.id);

          $(this).append($(ui.draggable));
        }
      });
    } );
</script>


<div class="background">
  <div class="row">
    <div class="column">
      <div class="booyah-box chatbox">
        <p> Possible chat box goes here </p>
      </div>
      <div class="booyah-box move-history">
        <p> Possible list of last X moves </p>
      </div>
  </div>

  <div class="board">
    <table>
      <tbody>
        <% (1..8).each do |y_coord| %>
          <tr id = <%= y_coord %>>
            <% (1..8).each do |x_coord| %>
              <td id = <%= "(#{x_coord},#{y_coord})" %> class = <%= "#{(y_coord % 2 == x_coord % 2 ? "white" : "black-square")}" %> >
              <% if gamepiece = @pieces.where("(x_coord = ? AND y_coord = ?)", x_coord, y_coord).first %>
                <span class = <%= "#{(gamepiece.white? ? 'white-piece' : 'black-piece')}" %> id = "<%= gamepiece.piece.name %>"></span>
              <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>


  <div class="column">
    <div class="booyah-box captured-pieces">
      <p> Captured pieces show up here </p>
    </div>
    <% if @game.users.count > 1 %>
      <%= simple_form_for @game, url: forfeit_game_path(@game) do |f| %>
        <% if current_user.id == @game.white_player %>
          <%= f.input :winner_user_id, as: :hidden, :input_html => { :value => @game.black_player.id } %>
        <% else %>
          <%= f.input :winner_user_id, as: :hidden, :input_html => { :value => @game.white_player.id } %>
        <% end %>
        <span class="float-right"><%= f.submit "Forfeit", class: "btn btn-danger btn-lg" %></span>
      <% end %>
    <% end %>
    </div>
  </div>
</div>
